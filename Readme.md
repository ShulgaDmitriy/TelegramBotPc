# Telegram Bot for Remote PC Control

## Описание
Этот Telegram-бот позволяет удалённо управлять компьютером под управлением Windows. Бот поддерживает команды для выключения, перезагрузки, блокировки экрана, создания скриншотов, воспроизведения голосовых сообщений, отображения текста на экране и получения статуса системы. Бот имеет ограничение доступа (только для авторизованного пользователя) и поддерживает чистый чат, удаляя предыдущие сообщения.

## Функционал
### Основные команды
- **/start**: Запускает бота и отображает главное меню с кнопками: `Screenshot`, `Fun`, `Status`, `Power`.
- **/msg**: Позволяет ввести текст, который отображается в окне на экране компьютера с кнопкой "Иди нахуй".
- **/play**: Воспроизводит последнее сохранённое голосовое сообщение через `ffplay`.

### Главное меню
- **Screenshot**: Создаёт скриншот рабочего стола и отправляет его в чат.
- **Fun**: Открывает подменю с опциями:
  - **Msg**: Аналог `/msg`, запрашивает текст для отображения.
  - **Назад**: Возвращает в главное меню.
- **Status**: Отображает информацию о системе:
  - Время работы системы (часы, минуты, секунды).
  - Загрузка процессора (%).
  - Использование оперативной памяти (ГБ).
  - Версия операционной системы.
- **Power**: Открывает подменю с опциями:
  - **PowerOff**: Запрашивает подтверждение для выключения компьютера.
  - **Reboot**: Запрашивает подтверждение для перезагрузки компьютера.
  - **Lock**: Запрашивает подтверждение для блокировки экрана.
  - **Назад**: Возвращает в главное меню.

### Работа с голосовыми сообщениями
- Отправка голосового сообщения сохраняет его как `sound.ogg` в папке `C:\Users\<username>\telegrambottmp`.
- Кнопка **Play** воспроизводит сохранённое сообщение через `ffplay`, отображая "Воспроизведение начато..." и "Воспроизведение Закончено.".
- Новое голосовое сообщение перезаписывает предыдущее.

### Управление чатом
- **Удаление сообщений**: Каждое новое сообщение бота или пользователя удаляет их предыдущее сообщение в чате, поддерживая только одно сообщение от бота и одно от пользователя.
- **Ограничение доступа**: Если пользователь не авторизован (ID не совпадает с `AUTHORIZED_USER_ID`), бот отвечает "А хуй пососать не хочешь?" и не выполняет команды.

### Первоначальная настройка
- При первом запуске появляется окно для ввода:
  - Токена бота (полученного от @BotFather в Telegram).
  - ID авторизованного пользователя (узнать через @userinfobot).
- Данные сохраняются в `C:\Users\<username>\telegrambottmp\config.json` и не запрашиваются при последующих запусках.
- После настройки бот копирует себя в автозагрузку Windows и запускается автоматически при старте системы без командной строки.

### Хранение файлов
- Все временные файлы (`sound.ogg`, `screenshot.png`, `config.json`, скрипт бота) сохраняются в `C:\Users\<username>\telegrambottmp`.
- Папка создаётся автоматически для текущего пользователя.

## Установка
### Требования
- **Операционная система**: Windows 10 или выше.
- **Python**: Версия 3.8 или выше. (Не выше 3.12.х)
- **FFmpeg**: Для воспроизведения голосовых сообщений.

### Шаг 1: Установка Python
1. Скачайте Python с [официального сайта](https://www.python.org/downloads/).
2. Установите Python, убедитесь, что опция "Add Python to PATH" включена.
3. Проверьте установку:
   ```bash
   python --version
   ```
   Ожидаемый вывод: `Python 3.x.x`.

### Шаг 2: Установка зависимостей
1. Откройте командную строку (Win+R, введите `cmd`, нажмите Enter).
2. Установите необходимые Python-библиотеки:
   ```bash
   pip install python-telegram-bot[job-queue] pydub pyautogui pyscreeze Pillow psutil pywin32
   ```
   - `python-telegram-bot[job-queue]`: Для работы бота и автоудаления сообщений.
   - `pydub`: Для обработки аудиофайлов.
   - `pyautogui`, `pyscreeze`: Для создания скриншотов.
   - `Pillow`: Для работы с изображениями.
   - `psutil`: Для получения статуса системы.
   - `pywin32`: Для создания ярлыков в автозагрузке.

3. Проверьте установку `tkinter` (встроен в Python):
   ```bash
   python -c "import tkinter; print(tkinter.TkVersion)"
   ```
   Если возникает ошибка, переустановите Python.

### Шаг 3: Установка FFmpeg
1. Скачайте FFmpeg с [официального сайта](https://ffmpeg.org/download.html) или используйте версию от [gyan.dev](https://github.com/GyanD/codexffmpeg/releases).
2. Распакуйте архив в папку, например, `C:\ffmpeg`.
3. Добавьте путь к папке `bin` в переменную PATH:
   - Нажмите Win+R, введите `sysdm.cpl`, нажмите Enter.
   - Перейдите во вкладку "Дополнительно" → "Переменные среды".
   - В разделе "Системные переменные" найдите `Path`, нажмите "Изменить".
   - Добавьте путь, например, `C:\ffmpeg\bin`.
4. Проверьте установку:
   ```bash
   ffmpeg -version
   ffplay -version
   ```
   Убедитесь, что обе команды возвращают версию FFmpeg.

### Шаг 4: Настройка бота
1. Создайте бота через @BotFather в Telegram:
   - Отправьте `/newbot`.
   - Следуйте инструкциям, получите токен (например, `123456789:ABCDEF...`).
2. Узнайте ваш Telegram ID через @userinfobot:
   - Отправьте `/start`, бот вернёт ваш ID (например, `123456789`).
3. Сохраните файл `TelegramBotSetup.py` в любую папку, например, `C:\Users\<username>\Downloads`.

### Шаг 5: Запуск бота
1. Дважды щёлкните по `TelegramBotSetup.py` или запустите через командную строку:
   ```bash
   python TelegramBotSetup.py
   ```
2. При первом запуске появится окно для ввода токена и ID.
3. Введите данные, нажмите "Сохранить".
4. Бот скопирует себя в `C:\Users\<username>\telegrambottmp`, создаст конфигурацию и добавится в автозагрузку.
5. Перезагрузите компьютер, чтобы проверить автозапуск (бот запустится без окна консоли).

## Использование
1. Отправьте `/start` в чат с ботом.
2. Используйте кнопки главного меню (`Screenshot`, `Fun`, `Status`, `Power`) или команды `/msg`, `/play`.
3. Для голосовых сообщений отправьте аудио, затем нажмите `Play`.
4. Чат будет содержать только одно сообщение бота и одно сообщение пользователя.

## Устранение неисправностей
- **Ошибка `No JobQueue`**:
  - Убедитесь, что установлена правильная версия библиотеки:
    ```bash
    pip install python-telegram-bot[job-queue]
    ```
- **Ошибка `ffplay не найден`**:
  - Проверьте, что FFmpeg установлен и добавлен в PATH (см. Шаг 3).
  - Выполните:
    ```bash
    ffplay -version
    ```
- **Окно настройки не появляется повторно**:
  - Проверьте наличие `C:\Users\<username>\telegrambottmp\config.json`.
  - Удалите файл, чтобы заново ввести токен и ID.
- **Бот не запускается автоматически**:
  - Проверьте папку автозагрузки:
    `C:\Users\<username>\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup`
  - Убедитесь, что файл `TelegramBot.lnk` присутствует.
- **Сообщения не удаляются**:
  - В групповых чатах убедитесь, что бот имеет права администратора с разрешением на удаление сообщений.
  - Проверьте консоль на наличие ошибок:
    ```bash
    python TelegramBotSetup.py
    ```

## Примечания
- Бот работает только на Windows из-за команд `shutdown` и `rundll32.exe`.
- Временные файлы (`sound.ogg`, `screenshot.png`) перезаписываются при каждом новом действии.
- Для изменения токена или ID удалите `config.json` и перезапустите бот.

## Лицензия
Этот проект распространяется под лицензией MIT. Используйте на свой страх и риск.
